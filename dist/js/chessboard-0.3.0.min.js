!function(){"use strict";var e="abcdefgh".split("");function r(e){if("string"!=typeof e)return!1;var r=e.split("-");return 2===r.length&&(!0===n(r[0])&&!0===n(r[1]))}function n(e){return"string"==typeof e&&-1!==e.search(/^[a-h][1-8]$/)}function t(e){if("string"!=typeof e)return!1;var r=(e=e.replace(/ .+$/,"")).split("/");if(8!==r.length)return!1;for(var n=0;n<8;n++)if(""===r[n]||r[n].length>8||-1!==r[n].search(/[^kqrbnpKQRNBP1-8]/))return!1;return!0}function o(e){if("object"!=typeof e)return!1;for(var r in e)if(!0===e.hasOwnProperty(r)&&(!0!==n(r)||!0!=("string"==typeof(t=e[r])&&-1!==t.search(/^[bw][KQRNBP]$/))))return!1;var t;return!0}function a(r){if(!0!==t(r))return!1;for(var n,o=(r=r.replace(/ .+$/,"")).split("/"),a={},i=8,s=0;s<8;s++){for(var p=o[s].split(""),c=0,f=0;f<p.length;f++){if(-1!==p[f].search(/[1-8]/))c+=parseInt(p[f],10);else a[e[c]+i]=(n=p[f]).toLowerCase()===n?"b"+n.toUpperCase():"w"+n.toUpperCase(),c++}i--}return a}function i(r){if(!0!==o(r))return!1;for(var n,t,a="",i=8,s=0;s<8;s++){for(var p=0;p<8;p++){var c=e[p]+i;!0===r.hasOwnProperty(c)?a+=(n=r[c],t=void 0,"w"===(t=n.split(""))[0]?t[1].toUpperCase():t[1].toLowerCase()):a+="1"}7!==s&&(a+="/"),i--}return a=(a=(a=(a=(a=(a=(a=a.replace(/11111111/g,"8")).replace(/1111111/g,"7")).replace(/111111/g,"6")).replace(/11111/g,"5")).replace(/1111/g,"4")).replace(/111/g,"3")).replace(/11/g,"2")}window.ChessBoard=window.ChessBoard||function(s,p){p=p||{};var c,f,d,u,h,l,v,g,w,y,m,b="1.7.0",x=a("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"),P={alpha:"alpha-d2270",black:"black-3c85d",board:"board-b72b1",chessboard:"chessboard-63f37",clearfix:"clearfix-7da63",highlight1:"highlight1-32417",highlight2:"highlight2-9c5d2",notation:"notation-322f9",numeric:"numeric-fc462",piece:"piece-417db",row:"row-5277c",sparePieces:"spare-pieces-7492f",sparePiecesBottom:"spare-pieces-bottom-ae20f",sparePiecesTop:"spare-pieces-top-4028b",square:"square-55d63",white:"white-1e1d7",overlay:"overlay-4fc5e",overlayArrow:"overlay-arrow-9d6ed",overlayGroup:"overlay-group-672a1"},O={},S=2,k="white",q={},E=!1,B={},C={};function T(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(e){return(16*Math.random()|0).toString(16)})}function M(e){return JSON.parse(JSON.stringify(e))}function I(e){var r=e.split(".");return{major:parseInt(r[0],10),minor:parseInt(r[1],10),patch:parseInt(r[2],10)}}function N(e,r,n){if(!0===p.hasOwnProperty("showErrors")&&!1!==p.showErrors){var t="ChessBoard Error "+e+": "+r;return"console"===p.showErrors&&"object"==typeof console&&"function"==typeof console.log?(console.log(t),void(arguments.length>=2&&console.log(n))):"alert"===p.showErrors?(n&&(t+="\n\n"+JSON.stringify(n)),void window.alert(t)):void("function"==typeof p.showErrors&&p.showErrors(e,r,n))}}function j(){if("string"==typeof s){if(""===s)return window.alert("ChessBoard Error 1001: The first argument to ChessBoard() cannot be an empty string.\n\nExiting..."),!1;var e=document.getElementById(s);if(!e)return window.alert('ChessBoard Error 1002: Element with id "'+s+'" does not exist in the DOM.\n\nExiting...'),!1;c=$(e)}else if(1!==(c=$(s)).length)return window.alert("ChessBoard Error 1003: The first argument to ChessBoard() must be an ID or a single DOM node.\n\nExiting..."),!1;return window.JSON&&"function"==typeof JSON.stringify&&"function"==typeof JSON.parse?(window.$,!(!$.fn||!$.fn.jquery||!0!=(r=$.fn.jquery,n=b,r=I(r),n=I(n),1e4*r.major*1e4+1e4*r.minor+r.patch>=1e4*n.major*1e4+1e4*n.minor+n.patch))||(window.alert("ChessBoard Error 1005: Unable to find a valid version of jQuery. Please include jQuery "+b+" or higher on the page.\n\nExiting..."),!1)):(window.alert("ChessBoard Error 1004: JSON does not exist. Please include a JSON polyfill.\n\nExiting..."),!1);var r,n}function D(e){return"fast"===e||"slow"===e||parseInt(e,10)+""==e+""&&e>=0}function A(e,r){var n=document.createElementNS("http://www.w3.org/2000/svg",e);for(var t in r)n.setAttribute(t,r[t]);return $(n)}function L(){if(!0===p.hasOwnProperty("overlay")){var e=A("defs",{});e.append(A("marker",{id:"arrowhead",viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"strokeWidth",markerWidth:"3",markerHeight:"2",orient:"auto"}).append(A("path",{d:"M 0 0 L 5 5 L 0 10 Z"})),A("marker",{id:"bulb",viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"strokeWidth",markerWidth:"3",markerHeight:"2",orient:"auto"}).append(A("circle",{cx:5,cy:5,r:4}))),l.empty(),l.append(e)}}function X(e){return"function"==typeof p.pieceTheme?p.pieceTheme(e):"string"==typeof p.pieceTheme?p.pieceTheme.replace(/{piece}/g,e):(N(8272,"Unable to build image source for cfg.pieceTheme."),"")}function Y(e,r,n){var t='<img src="'+X(e)+'" ';return n&&"string"==typeof n&&(t+='id="'+n+'" '),t+='alt="" class="'+P.piece+'" data-piece="'+e+'" style="width: '+v+"px;height: "+v+"px;",!0===r&&(t+="display:none;"),t+='" />'}function J(e){var r=["wK","wQ","wR","wB","wN","wP"];"black"===e&&(r=["bK","bQ","bR","bB","bN","bP"]);for(var n="",t=0;t<r.length;t++)n+=Y(r[t],!1,B[r[t]]);return n}function Q(e,r,n,t){var o=$("#"+C[e]),a=o.offset(),i=$("#"+C[r]),s=i.offset(),c=T();$("body").append(Y(n,!0,c));var f=$("#"+c);f.css({display:"",position:"absolute",top:a.top,left:a.left}),o.find("."+P.piece).remove();var d={duration:p.moveSpeed,complete:function(){i.append(Y(n)),f.remove(),"function"==typeof t&&t()}};f.animate(s,d)}function R(e,r,n){var t=$("#"+B[e]).offset(),o=$("#"+C[r]),a=o.offset(),i=T();$("body").append(Y(e,!0,i));var s=$("#"+i);s.css({display:"",position:"absolute",left:t.left,top:t.top});var c={duration:p.moveSpeed,complete:function(){o.find("."+P.piece).remove(),o.append(Y(e)),s.remove(),"function"==typeof n&&n()}};s.animate(a,c)}function U(r,n){r=r.split("");var t=e.indexOf(r[0])+1,o=parseInt(r[1],10);n=n.split("");var a=e.indexOf(n[0])+1,i=parseInt(n[1],10),s=Math.abs(t-a),p=Math.abs(o-i);return s>=p?s:p}function K(r,n,t){for(var o=function(r){for(var n=[],t=0;t<8;t++)for(var o=0;o<8;o++){var a=e[t]+(o+1);r!==a&&n.push({square:a,distance:U(r,a)})}n.sort(function(e,r){return e.distance-r.distance});var i=[];for(t=0;t<n.length;t++)i.push(n[t].square);return i}(t),a=0;a<o.length;a++){var i=o[a];if(!0===r.hasOwnProperty(i)&&r[i]===n)return i}return!1}function W(){f.find("."+P.piece).remove();for(var e in q)!0===q.hasOwnProperty(e)&&$("#"+C[e]).append(Y(q[e]))}function z(){f.html(function(r){"black"!==r&&(r="white");var n="",t=M(e),o=8;"black"===r&&(t.reverse(),o=1);for(var a="white",i=0;i<8;i++){n+='<div class="'+P.row+'">';for(var s=0;s<8;s++){var c=t[s]+o;n+='<div class="'+P.square+" "+P[a]+" square-"+c+'" style="width: '+v+"px; height: "+v+'px" id="'+C[c]+'" data-square="'+c+'">',!0===p.showNotation&&(("white"===r&&1===o||"black"===r&&8===o)&&(n+='<div class="'+P.notation+" "+P.alpha+'">'+t[s]+"</div>"),0===s&&(n+='<div class="'+P.notation+" "+P.numeric+'">'+o+"</div>")),n+="</div>",a="white"===a?"black":"white"}n+='<div class="'+P.clearfix+'"></div></div>',a="white"===a?"black":"white","white"===r?o--:o++}return n}(k)),W(),!0===p.sparePieces&&("white"===k?(u.html(J("black")),h.html(J("white"))):(u.html(J("white")),h.html(J("black"))))}function G(e){var r=M(q),n=M(e);i(r)!==i(n)&&(!0===p.hasOwnProperty("onChange")&&"function"==typeof p.onChange&&p.onChange(r,n),q=e)}function H(e,r){for(var n in m)if(!0===m.hasOwnProperty(n)){var t=m[n];if(e>=t.left&&e<t.left+v&&r>=t.top&&r<t.top+v)return n}return"offboard"}function F(){f.find("."+P.square).removeClass(P.highlight1+" "+P.highlight2)}function Z(){F();var e=M(q);delete e[y],G(e),W(),d.fadeOut(p.trashSpeed),E=!1}function V(e,r,n,t){"function"==typeof p.onDragStart&&!1===p.onDragStart(e,r,M(q),k)||(E=!0,g=r,y=e,w="spare"===e?"offboard":e,function(){m={};for(var e in C)!0===C.hasOwnProperty(e)&&(m[e]=$("#"+C[e]).offset())}(),d.attr("src",X(r)).css({display:"",position:"absolute",left:n-v/2,top:t-v/2}),"spare"!==e&&$("#"+C[e]).addClass(P.highlight1).find("."+P.piece).css("display","none"))}function _(e,r){d.css({left:e-v/2,top:r-v/2});var t=H(e,r);t!==w&&(!0===n(w)&&$("#"+C[w]).removeClass(P.highlight2),!0===n(t)&&$("#"+C[t]).addClass(P.highlight2),"function"==typeof p.onDragMove&&p.onDragMove(t,w,y,g,M(q),k),w=t)}function ee(e){var r="drop";if("offboard"===e&&"snapback"===p.dropOffBoard&&(r="snapback"),"offboard"===e&&"trash"===p.dropOffBoard&&(r="trash"),!0===p.hasOwnProperty("onDrop")&&"function"==typeof p.onDrop){var t=M(q);"spare"===y&&!0===n(e)&&(t[e]=g),!0===n(y)&&"offboard"===e&&delete t[y],!0===n(y)&&!0===n(e)&&(delete t[y],t[e]=g);var o=M(q),a=p.onDrop(y,e,g,t,o,k);"snapback"!==a&&"trash"!==a||(r=a)}"snapback"===r?function(){if("spare"!==y){F();var e=$("#"+C[y]).offset(),r={duration:p.snapbackSpeed,complete:function(){W(),d.css("display","none"),!0===p.hasOwnProperty("onSnapbackEnd")&&"function"==typeof p.onSnapbackEnd&&p.onSnapbackEnd(g,y,M(q),k)}};d.animate(e,r),E=!1}else Z()}():"trash"===r?Z():"drop"===r&&function(e){F();var r=M(q);delete r[y],r[e]=g,G(r);var n=$("#"+C[e]).offset(),t={duration:p.snapSpeed,complete:function(){W(),d.css("display","none"),!0===p.hasOwnProperty("onSnapEnd")&&"function"==typeof p.onSnapEnd&&p.onSnapEnd(y,e,g)}};d.animate(n,t),E=!1}(e)}function re(e){e.preventDefault()}function ne(e){if(!0===p.draggable){var r=$(this).attr("data-square");!0===n(r)&&!0===q.hasOwnProperty(r)&&V(r,q[r],e.pageX,e.pageY)}}function te(e){if(!0===p.draggable){var r=$(this).attr("data-square");!0===n(r)&&!0===q.hasOwnProperty(r)&&(e=e.originalEvent,V(r,q[r],e.changedTouches[0].pageX,e.changedTouches[0].pageY))}}function oe(e){!0===p.sparePieces&&V("spare",$(this).attr("data-piece"),e.pageX,e.pageY)}function ae(e){!0===p.sparePieces&&V("spare",$(this).attr("data-piece"),(e=e.originalEvent).changedTouches[0].pageX,e.changedTouches[0].pageY)}function ie(e){!0===E&&_(e.pageX,e.pageY)}function se(e){!0===E&&(e.preventDefault(),_(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))}function pe(e){!0===E&&ee(H(e.pageX,e.pageY))}function ce(e){!0===E&&ee(H(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))}function fe(e){if(!1===E&&!0===p.hasOwnProperty("onMouseoverSquare")&&"function"==typeof p.onMouseoverSquare){var r=$(e.currentTarget).attr("data-square");if(!0===n(r)){var t=!1;!0===q.hasOwnProperty(r)&&(t=q[r]),p.onMouseoverSquare(r,t,M(q),k)}}}function de(e){if(!1===E&&!0===p.hasOwnProperty("onMouseoutSquare")&&"function"==typeof p.onMouseoutSquare){var r=$(e.currentTarget).attr("data-square");if(!0===n(r)){var t=!1;!0===q.hasOwnProperty(r)&&(t=q[r]),p.onMouseoutSquare(r,t,M(q),k)}}}function ue(){$("body").on("mousedown mousemove","."+P.piece,re),f.on("mousedown","."+P.square,ne),c.on("mousedown","."+P.sparePieces+" ."+P.piece,oe),f.on("mouseenter","."+P.square,fe),f.on("mouseleave","."+P.square,de),!0===(navigator&&navigator.userAgent&&-1!==navigator.userAgent.search(/MSIE/))?(document.ondragstart=function(){return!1},$("body").on("mousemove",ie),$("body").on("mouseup",pe)):($(window).on("mousemove",ie),$(window).on("mouseup",pe)),"ontouchstart"in document.documentElement==!0&&(f.on("touchstart","."+P.square,te),c.on("touchstart","."+P.sparePieces+" ."+P.piece,ae),$(window).on("touchmove",se),$(window).on("touchend",ce))}function he(){var e;c.html((e='<div class="'+P.chessboard+'">',!0===p.sparePieces&&(e+='<div class="'+P.sparePieces+" "+P.sparePiecesTop+'"></div>'),!0===p.overlay&&(e+='<svg class="'+P.overlay+'"></svg>'),e+='<div class="'+P.board+'"></div>',!0===p.sparePieces&&(e+='<div class="'+P.sparePieces+" "+P.sparePiecesBottom+'"></div>'),e+="</div>")),f=c.find("."+P.board),l=c.find("."+P.overlay),L(),!0===p.sparePieces&&(u=c.find("."+P.sparePiecesTop),h=c.find("."+P.sparePiecesBottom));var r=T();$("body").append(Y("wP",!0,r)),d=$("#"+r),S=parseInt(f.css("borderLeftWidth"),10),O.resize()}return O.clear=function(e){O.position({},e)},O.destroy=function(){c.html(""),d.remove(),c.unbind()},O.fen=function(){return O.position("fen")},O.flip=function(){O.orientation("flip")},O.move=function(){if(0!==arguments.length){for(var e=!0,n={},t=0;t<arguments.length;t++)if(!1!==arguments[t])if(!0===r(arguments[t])){var o=arguments[t].split("-");n[o[0]]=o[1]}else N(2826,"Invalid move passed to the move method.",arguments[t]);else e=!1;var a=function(e,r){e=M(e);for(var n in r)if(!0===r.hasOwnProperty(n)&&!0===e.hasOwnProperty(n)){var t=e[n];delete e[n],e[r[n]]=t}return e}(q,n);return O.position(a,e),a}},O.orientation=function(e){return 0===arguments.length?k:"white"===e||"black"===e?(k=e,void z()):"flip"===e?(k="white"===k?"black":"white",void z()):void N(5482,"Invalid value passed to the orientation method.",e)},O.position=function(e,r){return 0===arguments.length?M(q):"string"==typeof e&&"fen"===e.toLowerCase()?i(q):(!1!==r&&(r=!0),"string"==typeof e&&"start"===e.toLowerCase()&&(e=M(x)),!0===t(e)&&(e=a(e)),void(!0===o(e)?!0===r?(!function(e,r,n){!0;var t=0;function o(){++t===e.length&&(W(),!1,!0===p.hasOwnProperty("onMoveEnd")&&"function"==typeof p.onMoveEnd&&p.onMoveEnd(M(r),M(n)))}for(var a=0;a<e.length;a++)"clear"===e[a].type&&$("#"+C[e[a].square]+" ."+P.piece).fadeOut(p.trashSpeed,o),"add"===e[a].type&&!0!==p.sparePieces&&$("#"+C[e[a].square]).append(Y(e[a].piece,!0)).find("."+P.piece).fadeIn(p.appearSpeed,o),"add"===e[a].type&&!0===p.sparePieces&&R(e[a].piece,e[a].square,o),"move"===e[a].type&&Q(e[a].source,e[a].destination,e[a].piece,o)}(function(e,r){e=M(e),r=M(r);var n=[],t={};for(var o in r)!0===r.hasOwnProperty(o)&&!0===e.hasOwnProperty(o)&&e[o]===r[o]&&(delete e[o],delete r[o]);for(var o in r)if(!0===r.hasOwnProperty(o)){var a=K(e,r[o],o);!1!==a&&(n.push({type:"move",source:a,destination:o,piece:r[o]}),delete e[a],delete r[o],t[o]=!0)}for(var o in r)!0===r.hasOwnProperty(o)&&(n.push({type:"add",square:o,piece:r[o]}),delete r[o]);for(var o in e)!0===e.hasOwnProperty(o)&&!0!==t.hasOwnProperty(o)&&(n.push({type:"clear",square:o,piece:e[o]}),delete e[o]);return n}(q,e),q,e),G(e)):(G(e),W()):N(6482,"Invalid value passed to the position method.",e)))},O.resize=function(){v=function(){var e=parseInt(c.css("width"),10);if(!e||e<=0)return 0;for(var r=e-1;r%8!=0&&r>0;)r--;return r/8}(),f.css("width",8*v+"px"),l.css("width",8*v+"px"),l.css("height",8*v+"px"),l.css("padding",S+"px"),d.css({height:v,width:v}),!0===p.sparePieces&&c.find("."+P.sparePieces).css("paddingLeft",v+S+"px"),z()},O.start=function(e){O.position("start",e)},O.addArrowAnnotation=function(r,n){if(!0===p.overlay){var t=l.find("> .square-"+r);if(t.length||(t=A("g",{class:P.overlayGroup+" square-"+r}),l.append(t)),!(o=l.find("> g.square-"+r+" > path.square-"+n)).length){var o=A("path",{class:P.overlayArrow+" square-"+n,d:function(r,n){function t(e,r){return e<r?-.25:e>r?.25:0}var o={x:e.indexOf(r[0]),y:parseInt(r[1],10)-1},a={x:e.indexOf(n[0]),y:parseInt(n[1],10)-1};"white"==p.orientation&&(o.y=7-o.y,a.y=7-a.y);var i,s,c=Math.abs(o.x-a.x),f=Math.abs(o.y-a.y);0!=c&&0!=f&&c!=f?c>f?(i={x:a.x,y:o.y},s={x:0,y:t(o.y,a.y)}):(i={x:o.x,y:a.y},s={x:t(o.x,a.x),y:0}):s={x:t(o.x,a.x),y:t(o.y,a.y)};var d=["M",v*(o.x+.5),v*(o.y+.5)];return void 0!==i&&d.push("L",v*(i.x+.5),v*(i.y+.5)),d.push("L",v*(a.x+s.x+.5),v*(a.y+s.y+.5)),d.join(" ")}(r,n),"stroke-width":v/3});t.append(o)}}},O.removeArrowAnnotation=function(e,r){!0===p.overlay&&l.find("> g.square-"+e+(void 0!==r?" > path.square-"+r:"")).remove()},O.clearAnnotation=function(){L()},!0===j()&&1==("string"!=typeof p&&!0!==o(p)||(p={position:p}),"black"!==p.orientation&&(p.orientation="white"),k=p.orientation,!1!==p.showNotation&&(p.showNotation=!0),!0!==p.draggable&&(p.draggable=!1),"trash"!==p.dropOffBoard&&(p.dropOffBoard="snapback"),!0!==p.sparePieces&&(p.sparePieces=!1),!0===p.sparePieces&&(p.draggable=!0),(!0!==p.hasOwnProperty("pieceTheme")||"string"!=typeof p.pieceTheme&&"function"!=typeof p.pieceTheme)&&(p.pieceTheme="img/chesspieces/wikipedia/{piece}.png"),!0===p.hasOwnProperty("appearSpeed")&&!0===D(p.appearSpeed)||(p.appearSpeed=200),!0===p.hasOwnProperty("moveSpeed")&&!0===D(p.moveSpeed)||(p.moveSpeed=200),!0===p.hasOwnProperty("snapbackSpeed")&&!0===D(p.snapbackSpeed)||(p.snapbackSpeed=50),!0===p.hasOwnProperty("snapSpeed")&&!0===D(p.snapSpeed)||(p.snapSpeed=25),!0===p.hasOwnProperty("trashSpeed")&&!0===D(p.trashSpeed)||(p.trashSpeed=100),!0===p.hasOwnProperty("position")&&("start"===p.position?q=M(x):!0===t(p.position)?q=a(p.position):!0===o(p.position)?q=M(p.position):N(7263,"Invalid value passed to config.position.",p.position)),!0)&&(function(){for(var r=0;r<e.length;r++)for(var n=1;n<=8;n++){var t=e[r]+n;C[t]=t+"-"+T()}var o="KQRBNP".split("");for(r=0;r<o.length;r++){var a="w"+o[r],i="b"+o[r];B[a]=a+"-"+T(),B[i]=i+"-"+T()}}(),he(),ue()),O},window.ChessBoard.fenToObj=a,window.ChessBoard.objToFen=i}();